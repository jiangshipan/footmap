package com.jsp.footmap.service;import com.jsp.footmap.utils.RedisKeyUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.HashMap;import java.util.Map;@Servicepublic class LikeService {    @Autowired    JedisAdapter jedisAdapter;    /**     * 判断点赞还是反对     * @param uid     * @param entityType     * @param entityId     * @return     */    public int getLikeStatus(int uid, int entityType, int entityId) {        //根据uid分别生成一个likeKey和disLikeKey，再分别判断这两个值是否在对应的like和dislike集合中        //比如如果在likeKey集合中，返回1，否则-1        String likeKey = RedisKeyUtils.getLikeKey(entityId);        //判断值为uid的用户是否在key为likeKey的集合中        if (jedisAdapter.sismember(likeKey, String.valueOf(uid))) {            return 1;        }        String disLikeKey = RedisKeyUtils.getDisLikeKey(entityId);        return jedisAdapter.sismember(disLikeKey, String.valueOf(uid)) ? -1 : 0;    }    /**     * 点赞：用户点赞后，被点赞的like集合中就会加上一个该点赞的用户信息     * @param uid     * @param entityId     * @return     */    public Map<String, Long> like(int uid, int entityId) {        Map<String, Long> map = new HashMap<>();        //在当前shares上点赞后获取key： LIKE:ENTITY_SHARE:2        String likeKey = RedisKeyUtils.getLikeKey(entityId);        //在喜欢的集合中添加当前操作用户的id        jedisAdapter.sadd(likeKey, String.valueOf(uid));        String disLikeKey = RedisKeyUtils.getDisLikeKey(entityId);        jedisAdapter.srem(disLikeKey, String.valueOf(uid));        //返回点赞数量        map.put("like", jedisAdapter.scard(likeKey));        map.put("disLike", jedisAdapter.scard(disLikeKey));        return map;    }    /**     * 反对     * @param uid     * @param entityId     * @return     */    public Map<String, Long> disLike(int uid, int entityId) {        Map<String, Long> map = new HashMap<>();        //反对集合加uid        String disLikeKey = RedisKeyUtils.getDisLikeKey(entityId);        jedisAdapter.sadd(disLikeKey, String.valueOf(uid));        //从点赞集合删除uid        String likeKey = RedisKeyUtils.getLikeKey(entityId);        jedisAdapter.srem(likeKey, String.valueOf(uid));        //返回点赞数量        map.put("like", jedisAdapter.scard(likeKey));        map.put("disLike", jedisAdapter.scard(disLikeKey));        return map;    }}